@model TimeTrackingApp.Models.ViewModels.EmpPanelViewModel

<h2 class="text-center">Panel Pracownika</h2>

@if (Model.IsWorking)
{
    <form method="post" asp-action="EndWork" class="text-center">
        <button class="btn btn-danger mb-3 w-100">Zakończ pracę</button>
    </form>
}
else
{
    <div class="d-flex justify-content-center mb-3">
        <form asp-action="StartWork" method="post" class="w-100 w-md-50">
            <button class="btn btn-success w-100 py-2 fs-5 fw-bold rounded">Zacznij Prace</button>
        </form>
    </div>
}

    <table class="table table-striped table-bordered text-center" id="table">
    </table>

<div class="mb-4 d-flex flex-wrap justify-content-center gap-2">
    <div class="flex-grow-1 flex-sm-grow-0" style="min-width:150px;">
        <a class="btn btn-primary w-100" asp-action="Month">Godziny w miesiącu</a>
    </div>
    <div class="flex-grow-1 flex-sm-grow-0" style="min-width:150px;">
        <a class="btn btn-warning w-100" asp-controller="LeaveRequest" asp-action="MyRequests">Wnioski urlopowe</a>
    </div>
</div>


@if (TempData["Error"] != null)
{
    <div class="alert alert-danger mt-3">@TempData["Error"]</div>
}

@if (TempData["Success"] != null)
{
    <div class="alert alert-success mt-3">@TempData["Success"]</div>
}

<script>
    var szer = window.matchMedia("(max-width: 800px)");

    function renderTable() {
        let table = document.getElementById('table');
        if (szer.matches) {
            table.innerHTML = `
                @foreach (var e in Model.Entries)
                {
                        <tr><th>Data</th><td>@e.entrydate.ToString("dd-MM-yyyy")</td></tr>
                        <tr><th>Start</th><td>@e.starttime.ToString(@"hh\:mm")</td></tr>
                        <tr><th>Koniec</th><td>@(e.endtime.HasValue? e.endtime.Value.ToString(@"hh\:mm") : "W trakcie")</td></tr>
                        <tr><th>Godziny</th><td>@e.totalhours.ToString("F2")</td></tr>
                        <tr><td colspan="2"><hr/></td></tr>
                }
            `;
        } else {
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Start</th>
                        <th>Koniec</th>
                        <th>Godziny</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var e in Model.Entries)
                    {
                            <tr>
                                <td>@e.entrydate.ToString("dd-MM-yyyy")</td>
                                <td>@e.starttime.ToString(@"hh\:mm")</td>
                                <td>@(e.endtime.HasValue? e.endtime.Value.ToString(@"hh\:mm") : "W trakcie")</td>
                                <td>@e.totalhours.ToString("F2")</td>
                            </tr>
                    }
                </tbody>
            `;
        }
    }

    window.addEventListener('load', renderTable);
    szer.addEventListener('change', renderTable);
</script>
<hr />

<h3>Kalendarz urlopów</h3>

<div id="calendar"></div>


<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {

        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'pl',
            height: 650,

            events: '/Employee/GetLeavesForCalendar'
        });

        calendar.render();
    });
</script>
